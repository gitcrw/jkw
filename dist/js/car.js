"use strict";!function(){function c(t){var s=document.cookie.split("; "),a=!0,e=!1,n=void 0;try{for(var i,l=s[Symbol.iterator]();!(a=(i=l.next()).done);a=!0){var r=i.value.split("=");if(t==r[0])return r[1]}}catch(t){e=!0,n=t}finally{try{!a&&l.return&&l.return()}finally{if(e)throw n}}}($("#head").load("head.html"),$("#foot").load("foot.html"),$(".tabs div").eq(0).addClass("active"),$(".tabs div").click(function(){$(this).addClass("active").siblings().removeClass("active"),$("#goods_info ul").eq($(this).index()).css("display","block").siblings().css("display","none")}),c("user")&&c("pwd")?($(".tologin").css("display","none"),$("#goods_info").css("display","block")):($(".tologin").css("display","block"),$("#goods_info").css("display","none")),c("user")&&c("pwd"))&&new Promise(function(s){$.ajax({type:"post",url:"../api/cargoods.php",data:{user:c("user")},success:function(t){s(t)}})}).then(function(t){var a=JSON.parse(t),s=a.goods.map(function(t){var s=[];return t.imgurl?s=t.imgurl.split(","):s.push(t.fimgurl),'<li gid="'+t.gid+'" onselectstart="return false">\n\t\t\t\t\t\t\t<span class="spanl item"></span>\n\t\t\t\t\t\t\t<a href="detail.html?'+t.gid+'" target="_blank"><img src="../db_imgs/'+s[0]+'" alt="" /></a>\n\t\t\t\t\t\t\t<p class="name_p"><a href="detail.html?'+t.gid+'" target="_blank">'+t.name+'</a></p>\n\t\t\t\t\t\t\t<p class="spec_p">规格：10g*9袋（999）</p>\n\t\t\t\t\t\t\t<p class="price_p">'+t.price+'</p>\n\t\t\t\t\t\t\t<div class="shop_num" >\n\t\t\t\t\t\t\t\t<span class="num_btn down">-</span>\n\t\t\t\t\t\t\t\t<input type="text" value="1" class="num_text"/>\n\t\t\t\t\t\t\t\t<span class="num_btn up">+</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<p class="min_total">'+t.price+'</p>\n\t\t\t\t\t\t\t<a href="javascript:void(0);" class="del">删除</a>\n\t\t\t\t\t\t</li>'}).join("");function e(){0==$(".item").size()&&$("#goods_info").css("display","none")}function n(){0<$(".item[status='true']").size()?$("#js_btn").addClass("buyactive"):$("#js_btn").removeClass("buyactive")}function i(){var a=0,e=0;$(".item[status='true']").each(function(t,s){a+=parseFloat($(s).parent().find(".num_text").val()),e+=parseFloat($(s).parent().find(".min_total").html())}),$("#select_num").html(a),$("#all_price").html(e.toFixed(2))}function l(t,s){return(t*s).toFixed(2)}function r(t,s,a){$.ajax({type:"post",url:"../api/addcar.php",data:{user:c("user"),gid:t,num:s,change:a}})}function o(t){$(".goods_info li[gid="+t+"]").remove(),$.ajax({type:"post",url:"../api/deletecar.php",data:{user:c("user"),gid:t}})}$(".goods_info").html(s),a.num.forEach(function(t,s){$(".num_text").eq(s).val(t),$(".min_total").eq(s).html((a.goods[s].price*a.num[s]).toFixed(2))}),$(".shop_num").on("click",".up",function(){var t=$(this).prev().val(),s=$(this).parent().prev().html(),a=$(this).parent().parent().attr("gid");t++,$(this).prev().val(t),r(a,t,"change"),$(this).parent().next().html(l(s,t)),i()}),$(".shop_num").on("click",".down",function(){var t=$(this).next().val(),s=$(this).parent().prev().html(),a=$(this).parent().parent().attr("gid");--t<=1&&(t=1),$(this).next().val(t),r(a,t,"change"),$(this).parent().next().html(l(s,t)),i()}),$(".num_text").on("input click",function(){var t=$(this).val()-0,s=$(this).parent().prev().html(),a=$(this).parent().parent().attr("gid");t<=1&&(t=1),$(this).val(t),r(a,t,"change"),$(this).parent().next().html(l(s,t)),i()}),$(".item").on("click",function(){"true"==$(this).attr("status")?$(this).removeClass("select").attr("status",!1):$(this).addClass("select").attr("status",!0),$(".item").size()==$("[status='true']").size()?$(".allselect").addClass("select").attr("status",!0):$(".allselect").removeClass("select").attr("status",!1),i(),n()}),$(".allselect").on("click",function(){"true"==$(this).attr("status")?($(".item").removeClass("select").attr("status",!1),$(".allselect").removeClass("select").attr("status",!1)):($(".item").addClass("select").attr("status",!0),$(".allselect").addClass("select").attr("status",!0)),i(),n()}),$(".del").on("click",function(){if(window.confirm("你确定要删除吗?")){var t=$(this).parent().attr("gid");console.log(t),o(t),i(),e(),n()}}),$("#all_detele").on("click",function(){0==$(".item[status='true']").size()?alert("你没有选中商品哦!"):window.confirm("你确定要删除吗?")&&($(".item[status='true']").each(function(t,s){o($(s).parent().attr("gid"))}),i(),e(),n())}),$("#js_btn").click(function(){0==$(".item[status='true']").size()?alert("你没有选中商品哦!"):window.confirm("是否结算呢?")&&($(".item[status='true']").each(function(t,s){o($(s).parent().attr("gid"))}),alert("结算成功！你购买了"+$(select_num).html()+"件商品，共花费了"+$("#all_price").html()+"元"),i(),e(),n())}),e()})}();