"use strict";!function(){var t,n,p,d,u,m;$("#head").load("head.html",function(){$(".menu_title,.list").mouseenter(function(){$(".list").css("display","block")}),$(".list,.menu_title").mouseleave(function(){$(".list").css("display","none")}),$(".telimg").attr("src","../images/indexzx.jpg")}),$("#foot").load("foot.html"),t="fdj",n=document.getElementById(t),p=n.firstElementChild,d=n.lastElementChild,u=p.lastElementChild,m=d.lastElementChild,p.onmouseenter=function(){u.style.display="block",d.style.display="block"},p.onmouseleave=function(){u.style.display="none",d.style.display="none"},p.onmousemove=function(t){var n=t.pageX,s=t.pageY,e=p.offsetLeft,a=p.offsetTop,i=n-e-u.offsetWidth/2,l=s-a-u.offsetHeight/2;i<=0?i=0:i>=p.offsetWidth-u.offsetWidth&&(i=p.offsetWidth-u.offsetWidth),l<=0?l=0:l>=p.offsetHeight-u.offsetHeight&&(l=p.offsetHeight-u.offsetHeight),u.style.left=i+"px",u.style.top=l+"px";var o=i/(p.offsetWidth-u.offsetWidth),c=l/(p.offsetHeight-u.offsetHeight),r=m.offsetWidth-d.offsetWidth,f=m.offsetHeight-d.offsetHeight;m.style.left=-r*o+"px",m.style.top=-f*c+"px"};var l=document.getElementById("picimg"),o=document.getElementById("bigimg"),s=document.getElementsByClassName("picul")[0];s.children;s.onmouseover=function(t){var n=t.target.src;null!=n&&(l.src=n,o.src=n)};var c=decodeURI(location.search).slice(1);function r(t){var n=document.cookie.split("; "),s=!0,e=!1,a=void 0;try{for(var i,l=n[Symbol.iterator]();!(s=(i=l.next()).done);s=!0){var o=i.value.split("=");if(t==o[0])return o[1]}}catch(t){e=!0,a=t}finally{try{!s&&l.return&&l.return()}finally{if(e)throw a}}}new Promise(function(n){$.ajax({type:"post",url:"../api/goods.php",data:{gid:c},success:function(t){n(t)}})}).then(function(t){var n=JSON.parse(t);console.log(n);var s=n.map(function(t){return'<div class="info_t">\n            \t\t<div>\n            \t\t\t<h2>'+t.name+'</h2>\n            \t\t\t<span class="tspan1">'+t.desc+'</span>\n            \t\t</div>\n            \t\t<span class="tspan2">'+t.affect+'</span>\n            \t</div>\n            \t<div class="info_name">\n            \t\t<span class="spanl">通用名称：</span>\n            \t\t<a href="" class="info_a">'+t.name+'</a>\n            \t</div>\n            \t<div class="info_bh">\n            \t\t<span class="spanl">产品编号：</span>\n            \t\t<span>'+t.bh+'</span>\n            \t</div>\n            \t<div class="info_wh">\n            \t\t<span class="spanl">批准文号：</span>\n            \t\t<span>'+t.wh+'</span>\n            \t</div>\n            \t<div class="info_price">\n            \t\t<span class="spanl">价      格：</span>\n            \t\t<span class="price">￥'+t.price+'</span>\n            \t</div>\n            \t<div class="info_xz">\n            \t\t<span class="spanl">用药须知：</span>\n            \t\t<div class="ohid"><span>'+t.know+'</span></div>\n            \t</div>\n            \t<div class="info_place">\n            \t\t<span class="spanl">生产厂家：</span>\n            \t\t<a href="" class="info_a">'+t.place+'</a>\n            \t</div>\n            \t<div class="info_num" >\n            \t\t<span class="spanl">购买数量：</span>\n            \t\t<input type="text" class="num_text" value="1"/>\n            \t\t<span class="jt_t"></span>\n            \t\t<span class="jt_b"></span>\n            \t</div>\n            \t<div class="info_btn" onselectstart="return false">\n            \t\t<a href="" id="buy"></a>\n            \t\t<span href="" id="addcar"></span>\n            \t</div>'}).join("");$("#info").html(s);var e=[];n[0].imgurl?(e=n[0].imgurl.split(","),l.src="../db_imgs/"+e[0],o.src="../db_imgs/"+e[0]):(e.push(n[0].fimgurl),l.src="../db_imgs/"+n[0].fimgurl,o.src="../db_imgs/"+n[0].fimgurl);var a=e.map(function(t){return'<img src="../db_imgs/'+t+'">'}).join("");$(".picul").html(a),$(".picul img").eq(0).addClass("active"),$(".picul img").hover(function(){$(this).addClass("active").siblings().removeClass("active")}),$(".info_num").on("click",".jt_t",function(){var t=$(this).prev().val();t++,$(this).prev().val(t)}),$(".info_num").on("click",".jt_b",function(){var t=$(this).prev().prev().val();--t<=1&&(t=1),$(this).prev().prev().val(t)}),$(".num_text").on("input click",function(){var t=$(this).val()-0;t<=1&&(t=1),$(this).val(t)});var i=0;new Promise(function(n){setInterval(t,2e3);function t(){$.ajax({type:"post",url:"../api/checkcar.php",data:{user:r("user")},success:function(t){t&&(i=t-0,$("#r_car_num").html(t)),n(t)}})}t()}).then(function(t){$("#addcar").on("click",function(){if(r("user")&&r("pwd")){var t=$(".num_text").val();i+=t-0;var n=document.createElement("img");n.className="car_img",n.width=40,n.height=40,n.onselectstart="return false",n.src=$("#picimg").attr("src"),$("#addcar").append(n);var s=$("#addcar").offset(),e=$("#r_car").offset();$(n).animate({marginLeft:e.left-s.left,marginTop:e.top-s.top},600,function(){$(this).remove()}),$("#r_car_num").html(i),$.ajax({type:"post",url:"../api/addcar.php",data:{user:r("user"),gid:c,num:t}})}else alert("请先登录哦!")})})})}();